---
title: "CardChurnWorking"
author: "Mrunal"
date: "04/06/2022"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

Reading the File
```{r}
filePath<-"C:/Users/mruna/Documents/Dataset_BankChurners.csv"
ChurnDataV1<-read.csv(filePath, header=T, stringsAsFactors=F, na.strings=c("", "NA"))
```

Overview of Dataset
```{r}
str(ChurnDataV1)
```

Converting to Factors
```{r}
ChurnDataV1$Attrition_Flag<-factor(ChurnDataV1$Attrition_Flag, labels=c("Attrited", "Existing"))
ChurnDataV1$Gender<-factor(ChurnDataV1$Gender, labels=c("Female", "Male"))
ChurnDataV1$Education_Level<-factor(ChurnDataV1$Education_Level, labels=c("College", "Doctorate", "Graduate", "High School", "Post Graduate", "Uneducated", "Unknown"))
ChurnDataV1$Marital_Status<-factor(ChurnDataV1$Marital_Status, labels=c("Divorced", "Married", "Single", "Unknown"))
ChurnDataV1$Income_Category<-factor(ChurnDataV1$Income_Category, labels=c("$120K+", "$40K-$60K", "$60K-$80K", "$80K-$120K", "Less than $40K", "Unknown"))
ChurnDataV1$Card_Category<-factor(ChurnDataV1$Card_Category, labels=c("Blue", "Gold", "Platinum", "Silver"))
```

Overview of Dataset
```{r}
str(ChurnDataV1)
```


Churn Distribution - Pie Chart
```{r}
#install.packages("plotrix")
library(plotrix)
attritionTable<-table(ChurnDataV1$Attrition_Flag)
pie3D(attritionTable, main="Churn Distribution", labels = paste0(round(attritionTable/sum(attritionTable)*100, 0), "%"), border="white", col = rainbow(length(attritionTable)))
legend("topright", legend=levels(ChurnDataV1$Attrition_Flag), cex = 0.8, fill = rainbow(length(attritionTable)))
```
Age Distribution - Histogram
```{r}
hist(ChurnDataV1$Customer_Age, breaks=c(20:75),
     main="",
     xlab="Age",
     xlim = c(25,75), ylim = c(0,500))
```

Gender Distribution - Pie Chart
```{r}
#install.packages("lessR")
library(lessR)
gender <- data.frame(gend = ChurnDataV1$Gender)
PieChart(gend, hole = 0.5, values = "%", values_color = "black", data = gender,
         fill = "terrain", main="")
```
Number of Dependents - Pie Chart
```{r}
#install.packages("plotrix")
library(plotrix)
dependentTable<-table(ChurnDataV1$Dependent_count)
pie3D(dependentTable, main="Number of Dependenets", labels = paste0(round(dependentTable/sum(dependentTable)*100, 0), "%"), explode=0.1, col = rainbow(length(dependentTable)))
legend("topright", legend = c("0", "1", "2", "3", "4", "5"), cex = 0.8, fill = rainbow(length(dependentTable)))
```
Education Level - Pie Chart
```{r}
educationTable<-table(ChurnDataV1$Education_Level)
pie(educationTable, main="Education Levels", labels = paste0(round(educationTable/sum(dependentTable)*100, 0), "%"), col = rainbow(length(educationTable)))
legend("topright", legend=levels(ChurnDataV1$Education_Level), cex = 0.8, fill = rainbow(length(educationTable)))
```

Marital Status - Pie Chart
```{r}
MaritalTable<-table(ChurnDataV1$Marital_Status)
pie(MaritalTable, main="Marital Status", labels = paste0(round(MaritalTable/sum(MaritalTable)*100, 0), "%"), col = rainbow(length(MaritalTable)))
legend("topright", legend=levels(ChurnDataV1$Marital_Status), cex = 0.8, fill = rainbow(length(MaritalTable)))
```
Income Category - Pie Chart
```{r}
#install.packages("lessR")
library(lessR)
income <- data.frame(inc = ChurnDataV1$Income_Category)
PieChart(inc, hole = 0.3, values = "%", values_color = "black", data = income,
         fill = "terrain", main="Income Categories")
```
Card Category - Pie Chart
```{r}
#install.packages("lessR")
library(lessR)
cardCat <- data.frame(card = ChurnDataV1$Card_Category)
PieChart(card, hole = 0.3, values = "%", values_color = "black", data = cardCat,
         fill = "terrain", main="Card Categories")
```
Months on Book - Histogram
```{r}
hist(ChurnDataV1$Months_on_book, breaks=c(10:57),
     main="Length of Customer Association",
     xlab="Months",
     xlim = c(10,60), ylim = c(0,1000))
```
Months on Book vs Churn - Density Plot
```{r}
plot(density(ChurnDataV1$Months_on_book[which(ChurnDataV1$Attrition_Flag=="Existing")]),
     xlim=c(10,60), main="Length of Relationship vs Churn",
     xlab="Months on Book",
     col="green", lty=1)
lines(density(ChurnDataV1$Months_on_book[which(ChurnDataV1$Attrition_Flag=="Attrited")]),
      col="red", lty=1)
legend(10,0.11, legend=c("Existing","Attrited"),
       col=c("green", "red"), lty=c(1,1))
```


Total Relationships - Histogram
```{r}
hist(ChurnDataV1$Total_Relationship_Count, breaks=c(0.5:6.5),
     main="Total Relationships",
     xlab="Number of Relationships")
```
Total Relationships vs Churn - Boxplot
```{r}
boxplot(ChurnDataV1$Total_Relationship_Count ~ ChurnDataV1$Attrition_Flag,
        main="Relatiionships vs Churn", 
        xlab="Churn", ylab="Number of Relationships",
        outpch=21, outbg="red")
```

Months Inactive - Histogram
```{r}
hist(ChurnDataV1$Months_Inactive_12_mon, breaks=c(-0.5:6.5),
     main="Months Inactive - 12 month period",
     xlab="Number of months when inactive")
```
Contacts Count - Histogram
```{r}
hist(ChurnDataV1$Contacts_Count_12_mon, breaks=c(-0.5:6.5),
     main="Total Contacts",
     xlab="Number of Contacts")
```

Contacts vs Churn - Boxplot
```{r}
boxplot(ChurnDataV1$Contacts_Count_12_mon ~ ChurnDataV1$Attrition_Flag,
        main="Contacts vs Churn", 
        xlab="Churn", ylab="Number of Contacts",
        outpch=21, outbg="red")
```
One Hot Encoding
```{r}
library(caret)
dummy <- dummyVars(" ~ .", data=ChurnDataV1)
ChurnDataV2 <- data.frame(predict(dummy, newdata=ChurnDataV1))
```

Check the Dataframe
```{r}
str(ChurnDataV2)
```

Correlation Matrix
```{r}
#install.packages(corrplot)
library(corrplot)
corrMatrix<-cor(ChurnDataV2)
corrplot(corrMatrix, tl.cex=0.5, type="lower", insig="blank")
```
